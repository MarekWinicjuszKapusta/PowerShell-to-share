Write-host "Script for VulnerabilityGoogleChrome. Created by Marek.Kapusta@fujitsu.com"
#last update 14.04.2023

$ErrorActionPreference = 'SilentlyContinue'
#Function to generate a timestamp that is added to the log file
function Get-TimeStamp {
    return "[{0:MM/dd/yy} {0:HH:mm:ss}]" -f (Get-Date)   
}

#Function to generate a log file
if ((Test-Path -Path "$ENV:SystemDrive\support\logs\apps" -PathType Container) -ne $true ) {mkdir "$ENV:SystemDrive\support\logs\apps" | Out-Null}
$LogFile = "$ENV:SystemDrive\support\logs\apps\VulnerabilityGoogleChrome.log"

Function LogWrite{
    Param ([string]$logstring)
    Add-content $Logfile -value "$(Get-Timestamp) $logstring"
    Write-Host $logstring
}

#Variables
$chromeVersion = $(Get-Package -Name "Google Chrome").Version

LogWrite "** STARTING VulnerabilityGoogleChrome **"

LogWrite "Last run time for GoogleUpdateTaskMachineCore"
LogWrite (Get-ScheduledTask -TaskName GoogleUpdateTaskMachineCore* | Get-ScheduledTaskInfo).LastRunTime

try {
    Get-ScheduledTask -TaskName GoogleUpdateTaskMachineCore* | start-ScheduledTask
    LogWrite "START GoogleUpdateTaskMachineCore"
    }
Catch { 
       LogWrite $_.Exception.Message
       Out-Null
       }

LogWrite "Last run time for GoogleUpdateTaskMachineUA"
LogWrite (Get-ScheduledTask -TaskName GoogleUpdateTaskMachineUA* | Get-ScheduledTaskInfo).LastRunTime

try {
    Get-ScheduledTask -TaskName  GoogleUpdateTaskMachineUA* | Start-ScheduledTask
    LogWrite "START GoogleUpdateTaskMachineUA"
    }
Catch { 
       LogWrite $_.Exception.Message
       Out-Null
       }

LogWrite "Chrome version:"
LogWrite $chromeVersion

LogWrite "** ENDING VulnerabilityGoogleChrome **"

return $chromeVersion
